name: deploy

on:
  push:
    branches: none # [ main ]
  pull_request:
    branches: none # [ main ]

  workflow_dispatch:

jobs:
  call-workflow-A:
    uses: CloudwithNicholas/github-workflows/.github/workflows/github_linter.yml@main 
    with:
      username: CloudwithNicholas
    secrets:
      token: ${{ secrets.TOKEN }}

  # deploy-infra:
  #   dispatch:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/github-script@v6
  #       with:
  #         github-token: ${{ secrets.TOKEN }}
  #         script: |
  #           const result = await github.rest.actions.createWorkflowDispatch({
  #             owner: 'CloudwithNicholas',
  #             repo: 'backend-repo',
  #             workflow_id: 'deploy.yml',
  #             ref: 'heads/main'
  #           })
  #           console.log(result)
      
  dispatch:
    runs-on: ubuntu-latest
    steps:
    # - run: |
    #     curl -u "${{ secrets.PAT_USERNAME}}:${{secrets.PAT_TOKEN}}" \
    #       -H "Accept: application/vnd.github.everest-preview+json" \
    #       -H "Content-Type: application/json" \
    #       https://api.github.com/repos/docker-sstc/docker-notify/actions/workflows/main.yml/dispatches \
    #       --data '{"ref": "master"}'
    - uses: actions/github-script@v6
      with:
        github-token: ${{ secrets.TOKEN }}
        script: |
          await github.rest.actions.createWorkflowDispatch({
            owner: 'CloudwithNicholas',
            repo: 'backend-repo',
            workflow_id: 'deploy.yml',
            ref: 'main'
          })